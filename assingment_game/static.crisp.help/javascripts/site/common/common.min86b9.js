/**
 * crisp-relay-site-helpdesk - Helpdesk site. Serves user helpdesks
 * @version v2.0.0
 * @author Crisp IM SAS https://crisp.chat/
 * @date 8/2/2022
 */
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var _=t[s];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(e,_.key,_)}}return function(t,s,_){return s&&e(t.prototype,s),_&&e(t,_),t}}(),CrispHelpdeskCommon=new(function(){function e(){_classCallCheck(this,e),this.__search_debounce_delay=100,this.__search_report_delay=1e3,this.__suggest_min_length=2,this.__key_bindings={enter:13,up:38,down:40,tabular:9},this.__selectors={},this.__is_language_menu_open=!1,this.__is_pending_search=!1,this.__active_search_query=null,this.__active_search_results=null,this.__search_debounce_timeout=null,this.__search_report_timeout=null,this.__do_show_status_banner=!sessionStorage||!sessionStorage.getItem||"0"!==sessionStorage.getItem("status-banner"),this.__initialize()}return _createClass(e,[{key:"bind",value:function(){this.__toggle_status_banner()}},{key:"hide_status_banner",value:function(){this.__do_show_status_banner=!1,this.__toggle_status_banner(),sessionStorage&&sessionStorage.setItem&&sessionStorage.setItem("status-banner","0")}},{key:"key_global",value:function(e){var t=!0;switch(e.keyCode){case this.__key_bindings.enter:t=this.__select_active_search_result();break;case this.__key_bindings.up:t=this.__move_active_search_result(-1);break;case this.__key_bindings.down:t=this.__move_active_search_result(1);break;case this.__key_bindings.tabular:t=this.__expand_suggest();break;default:e.shiftKey!==!0&&e.metaKey!==!0&&e.ctrlKey!==!0&&e.altKey!==!0&&this.__reset_suggest_active()}return t}},{key:"click_global",value:function(e){var t=!0;return this.__check_hide_language(e),t}},{key:"resize_global",value:function(){this.__reset_suggest_active()}},{key:"toggle_language",value:function(){this.__is_language_menu_open=!this.__is_language_menu_open,this._apply_attribute_cache("language",".csh-header-main-actions-locale","expanded",this.__is_language_menu_open)}},{key:"toggle_search_focus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._apply_attribute_cache("search",".csh-header-search","has-focus",e),e===!1&&(this.__reset_suggest(),this.__reset_search())}},{key:"type_search_field",value:function(e){var t=this,s=(e.value||"").trim();s!==(this.__active_search_query||"")&&(this.__clear_search_timeout(),s&&this.__change_pending_search(!0),this.__search_debounce_timeout=setTimeout(function(){t.__active_search_query=s,s?(t.__proceed_suggest(s),t.__proceed_search(s)):(t.__reset_suggest(),t.__reset_search(!1))},s?this.__search_debounce_delay:0))}},{key:"search_search_field",value:function(e){this.type_search_field(e)}},{key:"mouse_search_result",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.__set_active_search_result(e,t)}},{key:"open_chatbox",value:function(){window.$crisp.push(["do","chat:show"]),window.$crisp.push(["do","chat:open"])}},{key:"go_to_anchor",value:function(e){e.id&&(window.location.hash="#"+e.id)}},{key:"_select_element_cache",value:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],_=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this.__selectors[e]=(s===!0?null:this.__selectors[e])||document[_===!0?"querySelector":"querySelectorAll"](t),this.__selectors[e]}},{key:"_apply_attribute_cache",value:function(e,t,s,_){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=[];if(n===!0){var r=this._select_element_cache(e,t,a,!0);r&&i.push(r)}else i=this._select_element_cache(e,t,a,!1);if(i.length>0)for(var c="data-"+s,l=_===!0?"true":"false",h=0;h<i.length;h++)i[h].setAttribute(c,l)}},{key:"_load_include",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,_=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a="";if(null!==t)for(var n in t)a&&(a+="&"),a+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]);a&&(a="?"+a);var i=new XMLHttpRequest;i.open("GET",""+e+a),i.responseType="document",i.onload=function(){200===this.status?"function"==typeof s&&s(this.response):"function"==typeof _&&_()},i.onerror=function(){"function"==typeof _&&_()},i.send()}},{key:"_submit_payload",value:function(e,t,s,_,a){var n=new XMLHttpRequest,i=s?JSON.stringify(s):null;n.open(e,t,!0),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?"function"==typeof _&&_(n):"function"==typeof a&&a(n))},n.setRequestHeader("Content-Type","application/json"),n.send(i)}},{key:"__initialize",value:function(){window.onresize=this.resize_global.bind(this),document.onkeydown=this.key_global.bind(this),document.onclick=this.click_global.bind(this)}},{key:"__toggle_status_banner",value:function(){var e=document.querySelector("mark");e&&(e.style.display=this.__do_show_status_banner===!0?"block":"none")}},{key:"__clear_search_timeout",value:function(){null!==this.__search_debounce_timeout&&(clearTimeout(this.__search_debounce_timeout),this.__search_debounce_timeout=null),null!==this.__search_report_timeout&&(clearTimeout(this.__search_report_timeout),this.__search_report_timeout=null)}},{key:"__change_pending_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.__is_pending_search!==e&&(this.__is_pending_search=e,this._apply_attribute_cache("search",".csh-header-search","pending",this.__is_pending_search))}},{key:"__set_active_search_result",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._apply_attribute_cache("search_result",".csh-include-search-result","active",!1,!0,!1),null!==e&&e.setAttribute("data-active",t===!0?"true":"false")}},{key:"__select_active_search_result",value:function(){if(null!==this.__active_search_results){var e=this.__active_search_results.querySelector(".csh-include-search-result[data-active='true']");if(e)return e.click(),!1}return!0}},{key:"__move_active_search_result",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(null!==this.__active_search_results){var t=this.__active_search_results.querySelectorAll(".csh-include-search-result");if((t||[]).length>0){for(var s=-1,_=0;_<t.length;_++)if("true"===t[_].getAttribute("data-active")){s=_;break}if(s+=e,s<0?s=t.length-1:s>=t.length&&(s=0),s>-1)return this.__set_active_search_result(t[s],!0),!1}}return!0}},{key:"__expand_suggest",value:function(){if(null!==this.__active_search_results){var e=this._select_element_cache("autocomplete",".csh-header-search-field-autocomplete"),t=(e.innerText||"").trim();if(t){var s=this._select_element_cache("search_field","input[name='search_query']");s.value=""+(s.value||"")+t,this.__reset_suggest()}return!1}return!0}},{key:"__reset_search",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.__clear_search_timeout(),this.__active_search_query=null,this.__active_search_results=null,this.__change_pending_search(!1),this._apply_attribute_cache("search",".csh-header-search","expanded",!1),e===!0){var t=this._select_element_cache("search_field","input[name='search_query']");t.value=""}}},{key:"__reset_suggest",value:function(){var e=this._select_element_cache("autocomplete",".csh-header-search-field-autocomplete");e.style.display="none",e.innerText=""}},{key:"__reset_suggest_active",value:function(){null!==this.__active_search_results&&this.__reset_suggest()}},{key:"__check_hide_language",value:function(e){if(this.__is_language_menu_open===!0){var t=e.path||("function"==typeof e.composedPath?e.composedPath():[]);if(t&&t.length>0){for(var s=this._select_element_cache("language",".csh-header-main-actions-locale"),_=!1,a=0;a<t.length;a++)if(t[a]===s){_=!0;break}_===!1&&this.toggle_language()}}}},{key:"__proceed_search",value:function(e){var t=this,s=this._select_element_cache("search",".csh-header-search");this._load_include(s.getAttribute("action"),{query:e},function(s){if(e===t.__active_search_query){t.__change_pending_search(!1);var _=s.getElementsByClassName("csh-include-search");if((_||[])[0]){var a=t._select_element_cache("search_results",".csh-header-search-results");for(t.__active_search_results=_[0];a.firstChild;)a.removeChild(a.firstChild);a.appendChild(_[0]),t._apply_attribute_cache("search",".csh-header-search","expanded",!0)}t.__search_report_timeout=setTimeout(function(){e===t.__active_search_query&&t.__proceed_report(e)},t.__search_report_delay)}},function(){e===t.__active_search_query&&t.__reset_search(!1)})}},{key:"__proceed_suggest",value:function(e){var t=this,s=this._select_element_cache("search",".csh-header-search"),_=e.substring(e.lastIndexOf(" ")+1).trim();_&&_.length>=this.__suggest_min_length&&this._load_include(s.getAttribute("data-target-suggest"),{part:_},function(e){var s=e.getElementsByClassName("csh-include-suggest"),_=[];(s||[])[0]&&_.push(s[0].innerText);var a=(_[0]||"").toLowerCase(),n=null,i=null;if(a){var r=t._select_element_cache("search_field","input[name='search_query']");i=r.value||"";var c=i.substring(i.lastIndexOf(" ")+1).trim().toLowerCase();c&&c.length<a.length&&a.substring(0,c.length)===c&&(n=a.substring(c.length))}if(n&&i){var l=t._select_element_cache("ruler_text",".csh-header-search-field-ruler-text");l.innerText=i;var h=t._select_element_cache("autocomplete",".csh-header-search-field-autocomplete");if(h.innerText=n,h.style.display="inline-block","rtl"===document.dir?h.style.left=l.offsetLeft-h.offsetWidth+"px":h.style.left=l.offsetLeft+l.offsetWidth+"px","function"==typeof window.getComputedStyle){var u=window.getComputedStyle(l.parentElement,null);if("rtl"===document.dir)h.offsetLeft<=parseInt(u.paddingLeft,10)&&t.__reset_suggest();else{var o=h.clientWidth+(h.offsetLeft-parseInt(u.paddingLeft,10));o>=parseInt(u.width,10)&&t.__reset_suggest()}}}else t.__reset_suggest()})}},{key:"__proceed_report",value:function(e){var t=this._select_element_cache("search",".csh-header-search");this._submit_payload("POST",t.getAttribute("data-target-report"),{query:e})}}]),e}());window.onload=function(){CrispHelpdeskCommon.bind()};